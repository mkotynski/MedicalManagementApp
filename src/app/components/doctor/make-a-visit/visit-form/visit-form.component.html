<div class="content">
  <div class="row">
    <div class="col-xs-12 col-lg-12">
      <div class="row" style="margin:auto">
        <h2> FORMULARZ WIZYTY</h2>
        <button class="btn btn-success" style="margin-left:auto" type="submit">ZAPISZ WIZYTĘ</button>
        <button class="btn btn-danger" type="button">ANULUJ</button>
      </div>
      <form>
        <div class="column">
          <b> DATA: {{date}}</b>
          <b style="margin-top:10px;"> DANE PERSONALNE PACJENTA</b>
          <mat-form-field appearance="fill">
            <mat-label> IMIĘ</mat-label>
            <input matInput disabled type="text" name="patientName" [(ngModel)]="visit.patient.name"/>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label> NAZWISKO</mat-label>
            <input matInput disabled type="text" name="patientSurname" [(ngModel)]="visit.patient.surname"/>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>DETALE DOTYCZĄCE WIZYTY</mat-label>
            <textarea matInput></textarea>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>STATUS WIZYTY</mat-label>
            <mat-select required [(ngModel)]="visit.visitStatus" name="visitType">
              <mat-option *ngFor="let r of enumKeys" [value]="r">
                {{ visitStatuses[r] }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="row full-width margin-auto background-color-f5f5f5 padding-bottom-10px">
          <div class="column p50-width margin-auto">
            <div>
              <h3 class="margin-0 styled-h3" style="padding:10px">OPCJE WIZYTY</h3>
            </div>
            <button class="btn btn-primary p80-width margin-auto" (click)="addNewRecipeForm()">DOŁĄCZ RECEPTE</button>
            <button class="btn btn-primary p80-width margin-top-20px margin-left-right-auto" (click)="openReferenceDialog()">DOŁĄCZ SKIEROWANIE</button>
            <button class="btn btn-primary p80-width margin-top-20px margin-left-right-auto" (click)="openReceiptDialog()">RACHUNEK ZA WIZYTĘ</button>
          </div>
          <div class="p50-width">
            <div><h3 class="margin-0">RACHUNEK ZA WIZYTĘ</h3></div>
            --
          </div>
        </div>

        <!-- RECIPES LIST-->
        <div class="margin-top-20px" *ngIf="recipes.length > 0">
          <h2 class="styled-h2">DOŁĄCZONE RECEPTY</h2>
          <table class="styled-table full-width">
            <thead>
            <tr>
              <th style="width: 1%">OPCJE</th>
              <th style="width: 3%">NR</th>
              <th style="max-width: 90%"></th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let recipe of recipes; let i = index">
              <td>
                <button class="btn btn-danger" (click)="deleteRecipe(recipe)">Usuń</button>
              </td>
              <td>#{{i + 1}}</td>

              <td>
                <table class="styled-table full-width">
                  <thead>
                  <tr>
                    <th>NR</th>
                    <th>OPIS</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let recipePos of recipe.recipePositionSet; let j = index">
                    <td>#{{j + 1}}</td>
                    <td>{{recipePos.description}}</td>
                  </tr>
                  </tbody>
                </table>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <!-- END RECIPES LIST-->

        <!-- REFERENCES LIST-->
        <div class="margin-top-20px" *ngIf="references.length > 0">
          <h2 class="styled-h2">DOŁĄCZONE SKIEROWANIA</h2>
          <table class="styled-table full-width">
            <thead>
            <tr>
              <th>OPCJE</th>
              <th>NR</th>
              <th>SKIEROWANIE DO</th>
              <th>OPIS</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let reference of references; let i = index">
              <td>
                <button class="btn btn-danger" (click)="deleteReference(reference)">Usuń</button>
              </td>
              <td>#{{i + 1}}</td>
              <td>{{reference.referenceTo}}</td>
              <td>{{reference.details}}</td>
            </tr>
            </tbody>
          </table>
        </div>
        <!-- END REFERENCES LIST-->

        <div class="margin-top-20px">
          <hr>
        </div>

        <!-- RECIPE FORM -->
        <div class="column">
          <ng-container *ngIf="showNewRecipeForm">
            <div class="column full-width styled-form border-green margin-auto">
              <h2 class="full-width styled-h2"> FORMULARZ NOWEJ RECEPTY</h2>
              <div class="row" class="margin-auto full-width">
                <div class="row" class="margin-auto full-width">
                  <mat-form-field appearance="fill">
                    <mat-label>KOD RECEPTY:</mat-label>
                    <input matInput disabled value="<WYGENEROWANO>"/>
                  </mat-form-field>
                  <mat-form-field appearance="fill">
                    <mat-label>DATA:</mat-label>
                    <input matInput disabled value="{{today}}"/>
                  </mat-form-field>
                </div>
              </div>
              <mat-form-field appearance="fill">
                <mat-label>WYBIERZ DATĘ WAŻNOŚCI</mat-label>
                <input matInput [(ngModel)]="newRecipe.expirationDate" [matDatepicker]="picker" name="datePicker">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
              <button class="btn btn-green p50-width margin-top-20px margin-bottom-20px"
                      (click)="addNewRecipePositionForm()" type="submit">Dodaj nową
                pozycję
              </button>
              <table class="styled-table full-width" *ngIf="newRecipe.recipePositionSet.length > 0">
                <thead>
                <tr>
                  <th style="width:20%">POZYCJA</th>
                  <th style="max-width:80%">OPIS</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let recipePosition of newRecipe.recipePositionSet; let i = index">
                  <td>#{{i + 1}}</td>
                  <td>{{recipePosition.description}}</td>
                  <hr>
                </tr>
                </tbody>
              </table>
              <ng-container *ngIf="showNewRecipePositionForm">
                <div class="styled-window full-width">
                  <mat-form-field class="margin-left-20px p90-width">
                    <mat-label>DETALE POZYCJI RECEPTY</mat-label>
                    <textarea [(ngModel)]="newRecipePosition.description" name="positionDescription"
                              class="full-width styled-textarea"
                              matInput></textarea>
                  </mat-form-field>
                  <div class="row" style="margin-left: auto;">
                    <button class="btn btn-success" (click)="addNewRecipePosition()" type="submit">Dodaj</button>
                    <button class="btn btn-danger" (click)="addNewRecipePositionForm()" type="button">Anuluj</button>
                  </div>
                </div>
              </ng-container>
              <div class="row full-width margin-auto">
                <button class="btn btn-success p50-width" (click)="addNewRecipe()" type="submit">DOŁĄCZ RECEPTĘ</button>
                <button class="btn btn-danger p50-width" (click)="cancelNewRecipe()" type="button">ANULUJ DOŁĄCZANIE
                </button>
              </div>
            </div>
          </ng-container>
        </div>
        <!-- END RECIPE FORM -->


        <!-- REFERENCE FORM -->

        <!-- END REFERENCE FORM -->


      </form>
    </div>
  </div>
</div>
